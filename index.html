<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رهبان - انتخاب مطمئن برای تصمیم های مهم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --bg-color: #f7fafc;
            --text-color-primary: #151450;
            --text-color-secondary: #4a5568;
            --card-bg-color: #ffffff;
            --border-color: #e2e8f0;
            --header-bg: rgba(255, 255, 255, 0.8);
        }

        html.dark {
            --bg-color: #1a202c;
            --text-color-primary: #e2e8f0;
            --text-color-secondary: #a0aec0;
            --card-bg-color: #2d3748;
            --border-color: #4a5568;
            --header-bg: rgba(26, 32, 44, 0.8);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-secondary);
            transition: background-color 0.3s, color 0.3s;
        }
        html {
            scroll-behavior: smooth;
        }
        section[id] {
            scroll-margin-top: 80px; 
        }
        .hero-bg {
            background-image: url('https://omidajamloo.github.io/telegram/images/header-bg.jpg');
            background-size: cover;
            background-position: center center;
            position: relative;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            background-color: rgba(21, 20, 80, 0.75);
            z-index: 1;
        }
        .content-z {
            position: relative;
            z-index: 2;
        }
        .primary-color { color: var(--text-color-primary); }
        .bg-primary-color { background-color: #151450; }
        .hover-bg-primary-color:hover { background-color: #0d0c3a; }
        .accent-color { color: #F06F11; }
        .bg-accent-color { background-color: #F06F11; }
        .hover-bg-accent-color:hover { background-color: #d8630c; }
        
        .service-card {
            background-color: var(--card-bg-color);
            border-radius: 1.25rem;
            padding: 2rem;
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            display: flex;
            flex-direction: column;
        }
        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .font-en {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }

        .chat-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(21, 20, 80, 0.6);
            backdrop-filter: blur(5px);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .chat-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }

        #ai-chat-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 90vw;
            max-width: 700px;
            height: 85vh;
            max-height: 800px;
            background-color: var(--card-bg-color);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s;
            z-index: 1000;
            pointer-events: none;
        }
        #ai-chat-modal.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        .chat-header {
            background-color: #151450;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header h3 {
            font-weight: 700;
        }
        .chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .chat-message {
            padding: 0.75rem 1rem;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.6;
        }
        .user-message {
            background-color: #F06F11;
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }
        .ai-message {
            background-color: var(--border-color);
            color: var(--text-color-primary);
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        .chat-input-form {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid var(--border-color);
            direction: rtl;
        }
        .chat-input-form input {
            flex-grow: 1;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            background-color: var(--bg-color);
            color: var(--text-color-primary);
        }
        .chat-input-form button {
            background-color: #151450;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .typing-indicator {
            align-self: flex-start;
            padding: 0.75rem 1rem;
        }
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #9ca3af;
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body>

    <header class="backdrop-blur-sm sticky top-0 z-50 shadow-sm" style="background-color: var(--header-bg); transition: background-color 0.3s;">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="font-extrabold text-2xl primary-color">رهبان</a>
            <div class="hidden md:flex items-center space-x-6 space-x-reverse">
                <a href="#services" class="font-semibold" style="color: var(--text-color-secondary); transition: color 0.3s;">خدمات</a>
                <a href="#process" class="font-semibold" style="color: var(--text-color-secondary); transition: color 0.3s;">فرآیند کار</a>
                <a href="#ai-assistant" class="font-semibold" style="color: var(--text-color-secondary); transition: color 0.3s;">دستیار هوشمند</a>
                <a href="#calculator" class="font-semibold" style="color: var(--text-color-secondary); transition: color 0.3s;">ماشین حساب</a>
                <a href="#contact" class="font-semibold" style="color: var(--text-color-secondary); transition: color 0.3s;">تماس با ما</a>
                
                <!-- Theme Toggle Button -->
                <button id="theme-toggle" class="p-2 rounded-full" style="color: var(--text-color-secondary);">
                    <svg id="theme-toggle-sun-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05A1 1 0 003.636 6.464l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 11a1 1 0 100-2H2a1 1 0 100 2h1zM6.464 16.364l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-1.414-1.414z"></path></svg>
                    <svg id="theme-toggle-moon-icon" class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
            </div>
            <button id="menu-btn" class="md:hidden primary-color">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4 border-t" style="background-color: var(--header-bg); border-color: var(--border-color); transition: background-color 0.3s;">
              <a href="#services" class="block py-2 font-semibold" style="color: var(--text-color-secondary);">خدمات</a>
              <a href="#process" class="block py-2 font-semibold" style="color: var(--text-color-secondary);">فرآیند کار</a>
              <a href="#ai-assistant" class="block py-2 font-semibold" style="color: var(--text-color-secondary);">دستیار هوشمند</a>
              <a href="#calculator" class="block py-2 font-semibold" style="color: var(--text-color-secondary);">ماشین حساب</a>
              <a href="#contact" class="block py-2 font-semibold" style="color: var(--text-color-secondary);">تماس با ما</a>
        </div>
    </header>

    <main>
        <section id="hero" class="hero-bg min-h-screen flex items-center justify-center">
            <div class="container mx-auto px-6 py-24 text-center content-z">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white mb-4">انتخاب مطمئن برای تصمیم‌های مهم</h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-4xl mx-auto mb-8">گروه کارشناسان رهبان با تخصص ویژه در امور حقوقی، بازرگانی، اداری و منابع انسانی، همراهی مطمئن برای پیشبرد اهداف و کاهش ریسک‌های واحدهای صنعتی و تولیدی است.</p>
                <a href="#services" class="bg-accent-color text-white font-bold py-3 px-8 rounded-lg text-lg hover-bg-accent-color transition-colors shadow-lg">آشنایی با خدمات</a>
            </div>
        </section>

        <section id="services" class="py-20" style="background-color: var(--card-bg-color); transition: background-color 0.3s;">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-extrabold mb-3 primary-color">خلاصه خدمات رهبان</h2>
                    <p class="text-lg" style="color: var(--text-color-secondary);">با ارائه بهترین راه حل و تدابیر، یاری‌گر شما هستیم.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                    <div class="service-card">
                        <h3 class="text-2xl font-bold mb-4 primary-color">امور حقوقی</h3>
                        <ul class="space-y-2 list-disc list-inside" style="color: var(--text-color-secondary);">
                            <li>کارشناسی حقوقی تخصصی (تجارت، کار، تأمین اجتماعی)</li>
                            <li>تدوین و تنظیم انواع اسناد حقوقی (قرارداد، صورتجلسه)</li>
                            <li>نمایندگی در دعاوی کارگر و کارفرما در اداره کار</li>
                            <li>مصالحه و داوری جهت جلوگیری از فرآیند دادرسی</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <h3 class="text-2xl font-bold mb-4 primary-color">امور بازرگانی</h3>
                         <ul class="space-y-2 list-disc list-inside" style="color: var(--text-color-secondary);">
                            <li>اخذ و تدوین طرح توجیهی و گواهی تولید</li>
                            <li>انجام فرآیندهای ثبت سفارش و اظهار گمرکی</li>
                            <li>ترخیص کالا با تخصص در مناطق ویژه (مانند سلفچگان)</li>
                            <li>بهینه‌سازی هزینه‌ها و بررسی تعرفه کالا (HS Code)</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <h3 class="text-2xl font-bold mb-4 primary-color">جذب و استخدام | امور اداری</h3>
                        <ul class="space-y-2 list-disc list-inside" style="color: var(--text-color-secondary);">
                            <li>ایجاد پل ارتباطی موثر بین کارفرمایان و نیروهای متخصص</li>
                            <li>تأمین نیروی انسانی متعهد و توانمند</li>
                            <li>انجام امور بیمه‌ای (تأمین اجتماعی و بیمه تکمیلی)</li>
                        </ul>
                    </div>
                    <div class="service-card">
                        <h3 class="text-2xl font-bold mb-4 primary-color">حسابرسی، مالیات و امور بانکی</h3>
                        <ul class="space-y-2 list-disc list-inside" style="color: var(--text-color-secondary);">
                            <li>همکاری با معتبرترین شرکت‌های حسابرسی</li>
                            <li>کاهش ریسک جرائم مالیاتی و بیمه‌ای</li>
                            <li>اخذ ضمانت‌نامه‌های بانکی و اعتبارات اسنادی (LC)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="process" class="py-20">
            <div class="container mx-auto px-6">
               <div class="text-center mb-16">
                   <h2 class="text-3xl md:text-4xl font-extrabold mb-3 primary-color">فرآیند آنالیز ریسک کسب‌وکار شما</h2>
                   <p class="text-lg" style="color: var(--text-color-secondary);">یک مسیر شفاف ۵ مرحله‌ای برای شناسایی و رفع چالش‌های پیش روی شما.</p>
               </div>
               <div class="relative max-w-4xl mx-auto">
                   <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                       <div class="text-center relative"><div class="bg-primary-color text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 z-10 relative">۱</div><h4 class="font-bold primary-color">بازدید و عارضه‌یابی</h4><p class="text-sm">بازدید حضوری و ارائه گزارش اولیه</p></div>
                       <div class="text-center relative"><div class="bg-primary-color text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 z-10 relative">۲</div><h4 class="font-bold primary-color">تحلیل داده و اسناد</h4><p class="text-sm">بررسی مدارک و شناسایی ایرادات</p></div>
                       <div class="text-center relative"><div class="bg-primary-color text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 z-10 relative">۳</div><h4 class="font-bold primary-color">ارائه راهکار</h4><p class="text-sm">گزارش ثانویه و راهکارهای پیشنهادی</p></div>
                       <div class="text-center relative"><div class="bg-primary-color text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 z-10 relative">۴</div><h4 class="font-bold primary-color">اجرا و نمایندگی</h4><p class="text-sm">رفع ایرادات و اخذ مجوزها</p></div>
                       <div class="text-center relative"><div class="bg-primary-color text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4 z-10 relative">۵</div><h4 class="font-bold primary-color">پشتیبانی و پیگیری</h4><p class="text-sm">پیگیری مستمر امور اجرایی</p></div>
                   </div>
               </div>
            </div>
       </section>
        
        <section id="ai-assistant" class="py-20" style="background-color: var(--card-bg-color); transition: background-color 0.3s;">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-4xl font-extrabold mb-3 primary-color">دستیار هوشمند رهبان</h2>
                <p class="text-lg max-w-2xl mx-auto mb-8" style="color: var(--text-color-secondary);">برای دریافت پیش‌نویس‌های حقوقی، تحلیل‌های اولیه یا پاسخ به سوالات متداول خود، از دستیار هوشمند ما استفاده کنید.</p>
                <button id="ai-modal-toggle" class="bg-accent-color text-white font-bold py-3 px-8 rounded-lg text-lg hover-bg-accent-color transition-colors shadow-lg">
                    ✨ شروع گفتگو با دستیار هوشمند
                </button>
            </div>
        </section>

        <section id="calculator" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-extrabold mb-3 primary-color">ماشین حساب گمرکی</h2>
                    <p class="text-lg" style="color: var(--text-color-secondary);">هزینه های ترخیص کالای خود را به صورت جامع محاسبه کنید.</p>
                </div>
                <div class="max-w-3xl mx-auto p-8 rounded-2xl shadow-lg" style="background-color: var(--card-bg-color); border: 1px solid var(--border-color); transition: background-color 0.3s;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="goods-value" class="block font-semibold mb-2 primary-color">ارزش کالا (به دلار)</label>
                            <input type="text" id="goods-value" inputmode="numeric" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-indigo-300 text-left" dir="ltr" placeholder="e.g., 15000" style="background-color: var(--bg-color); border-color: var(--border-color); color: var(--text-color-primary);">
                        </div>
                        <div>
                             <label for="exchange-rate" class="block font-semibold mb-2 primary-color">نرخ ارز (به ریال)</label>
                            <input type="text" id="exchange-rate" inputmode="numeric" class="w-full p-3 border rounded-md focus:ring-2 focus:ring-indigo-300 text-left" dir="ltr" placeholder="e.g., 420000" style="background-color: var(--bg-color); border-color: var(--border-color); color: var(--text-color-primary);">
                        </div>
                    </div>
                    <button id="calculate-btn" class="w-full bg-accent-color hover-bg-accent-color text-white font-bold py-3 px-5 rounded-lg mt-6 transition-colors text-lg">محاسبه</button>
                    <div id="result-area" class="mt-8 hidden">
                        <div class="border-t pt-6" style="border-color: var(--border-color);">
                            <h3 class="text-xl font-bold text-center mb-4 primary-color">جزئیات هزینه‌ها (به ریال)</h3>
                            <div class="space-y-3 text-lg">
                                <div class="flex justify-between items-center p-3 rounded-md" style="background-color: var(--bg-color);"><span class="font-semibold primary-color">ارزش ریالی کالا:</span><span id="result-goods-value-rial" class="font-bold font-en primary-color"></span></div>
                                <div class="flex justify-between items-center p-3"><span>کرایه:</span><span id="result-freight" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-3 rounded-md" style="background-color: var(--bg-color);"><span>بیمه:</span><span id="result-insurance" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-3 font-bold primary-color border-t border-b" style="border-color: var(--border-color);"><span>ارزش CIF:</span><span id="result-cif" class="font-en"></span></div>
                                <div class="flex justify-between items-center p-3"><span>پسماند:</span><span id="result-waste" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-3 rounded-md" style="background-color: var(--bg-color);"><span>حقوق ورودی:</span><span id="result-duty" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-3"><span>هلال احمر (۱٪ حقوق ورودی):</span><span id="result-red-crescent" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-3 rounded-md" style="background-color: var(--bg-color);"><span>مالیات بر ارزش افزوده:</span><span id="result-vat" class="font-bold font-en"></span></div>
                                <div class="flex justify-between items-center p-4 bg-primary-color text-white rounded-lg mt-4 text-xl"><span class="font-bold">جمع کل پرداختی گمرک:</span><span id="result-total" class="font-extrabold font-en"></span></div>
                            </div>
                            <div class="mt-6 border-t pt-4 text-sm" style="border-color: var(--border-color);">
                                <h4 class="font-bold mb-2 primary-color">توضیحات:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>مبلغ کرایه در این محاسبه پرداخت نمی‌شود و صرفاً جهت محاسبه هزینه‌های گمرکی (مانند بیمه) استفاده می‌گردد.</li>
                                    <li>هزینه بیمه شامل مابه‌التفاوت هزینه بیمه باربری می‌باشد.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer id="contact" class="bg-primary-color text-white">
        <div class="container mx-auto px-6 pt-20 pb-12 text-center">
            <h2 class="text-2xl font-bold mb-4">گروه کارشناسان رهبان</h2>
            <p class="max-w-xl mx-auto mb-8 text-gray-300">برای دریافت مشاوره و شروع همکاری جهت حفاظت از دارایی‌های کسب‌وکارتان، با ما در تماس باشید.</p>
            <div class="flex flex-col md:flex-row justify-center items-center gap-6 text-lg">
                <a href="mailto:rahban.group.info@gmail.com" class="font-bold">rahban.group.info@gmail.com</a>
                <span class="hidden md:block">|</span>
                <a href="tel:09128547287" class="font-bold">۰۹۱۲۸۵۴۷۲۸۷</a>
            </div>
            <p class="mt-6 text-gray-400">آدرس: منطقه ویژه اقتصادی سلفچگان - میدان امام خمینی - مجتمع حسینی - پلاک 8</p>
            <div class="mt-12 border-t border-gray-700 pt-8">
                 <p class="text-gray-400 text-sm">&copy; کلیه حقوق این وب‌سایت متعلق به گروه کارشناسان رهبان می‌باشد.</p>
            </div>
        </div>
    </footer>

    <!-- AI Chat Modal -->
    <div id="chat-backdrop" class="chat-backdrop hidden"></div>
    <div id="ai-chat-modal" class="hidden">
        <div class="chat-header">
            <h3>دستیار هوشمند رهبان</h3>
            <button class="chat-close-btn">&times;</button>
        </div>
        <div class="chat-messages">
            <div class="chat-message ai-message">سلام! چطور می‌توانم به شما کمک کنم؟ سوال خود را در زمینه حقوق کسب‌وکار یا امور بازرگانی بپرسید.</div>
        </div>
        <form class="chat-input-form">
            <input type="text" placeholder="پیام خود را بنویسید..." autocomplete="off">
            <button type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
            </button>
        </form>
    </div>

    <!-- Floating Action Button -->
    <a href="https://forms.gle/cJdyKmKY4Y4HRQHKA" target="_blank" id="fab-google-form" class="hidden fixed bottom-8 right-8 bg-accent-color text-white w-16 h-16 rounded-full flex items-center justify-center text-3xl shadow-lg transform hover:scale-110 transition-transform z-40 opacity-80 hover:opacity-100" title="فرم نظرسنجی/درخواست">
        📝
    </a>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- THEME TOGGLE LOGIC ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('theme-toggle-sun-icon');
            const moonIcon = document.getElementById('theme-toggle-moon-icon');

            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            };

            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme) {
                applyTheme(savedTheme);
            } else if (prefersDark) {
                applyTheme('dark');
            } else {
                applyTheme('light');
            }
            
            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                const newTheme = isDark ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            // --- Mobile Menu ---
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            if (menuBtn && mobileMenu) {
                menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            }
            document.querySelectorAll('#mobile-menu a, .nav a').forEach(link => {
                link.addEventListener('click', () => {
                    if(window.innerWidth < 768) { 
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            // --- Calculator Logic ---
            const calculateBtn = document.getElementById('calculate-btn');
            const goodsValueInput = document.getElementById('goods-value');
            const exchangeRateInput = document.getElementById('exchange-rate');
            const resultArea = document.getElementById('result-area');

            function toEnglishDigits(str) {
                if (typeof str !== 'string') return str;
                return str.replace(/[۰-۹]/g, d => '۰۱۲۳۴۵۶۷۸۹'.indexOf(d)).replace(/[٠-٩]/g, d => '٠١٢٣٤٥٦٧٨٩'.indexOf(d));
            }

            if (calculateBtn) {
                calculateBtn.addEventListener('click', () => {
                    try {
                        const valueStr = toEnglishDigits(goodsValueInput.value || '0').replace(/,/g, '');
                        const rateStr = toEnglishDigits(exchangeRateInput.value || '0').replace(/,/g, '');
                        const value = parseFloat(valueStr);
                        const rate = parseFloat(rateStr);

                        if (isNaN(value) || isNaN(rate) || value <= 0 || rate <= 0) {
                            alert('لطفا مقادیر معتبر وارد کنید.');
                            return;
                        }

                        const goodsValueRial = Math.floor(value * rate);
                        const freight = Math.floor(goodsValueRial * 0.10);
                        const insurance = Math.floor((goodsValueRial + freight) * 0.005);
                        const cif = goodsValueRial + freight + insurance;
                        const waste = Math.floor(cif * 0.005);
                        const duty = Math.floor(cif * 0.04);
                        const redCrescent = Math.floor(duty * 0.01);
                        const vat = Math.floor((cif + duty) * 0.10);
                        const total = Math.floor(waste + duty + redCrescent + vat);

                        document.getElementById('result-goods-value-rial').textContent = goodsValueRial.toLocaleString('en-US');
                        document.getElementById('result-freight').textContent = freight.toLocaleString('en-US');
                        document.getElementById('result-insurance').textContent = insurance.toLocaleString('en-US');
                        document.getElementById('result-cif').textContent = cif.toLocaleString('en-US');
                        document.getElementById('result-waste').textContent = waste.toLocaleString('en-US');
                        document.getElementById('result-duty').textContent = duty.toLocaleString('en-US');
                        document.getElementById('result-red-crescent').textContent = redCrescent.toLocaleString('en-US');
                        document.getElementById('result-vat').textContent = vat.toLocaleString('en-US');
                        document.getElementById('result-total').textContent = total.toLocaleString('en-US');

                        resultArea.classList.remove('hidden');
                    } catch (error) {
                        console.error("Calculator error:", error);
                        alert('خطایی در محاسبه رخ داد. لطفا ورودی خود را بررسی کنید.');
                    }
                });
            }

            // --- Floating Action Button ---
            const fab = document.getElementById('fab-google-form');
            if(fab) {
                window.addEventListener('scroll', () => {
                    if (window.scrollY > 300) {
                        fab.classList.remove('hidden');
                    } else {
                        fab.classList.add('hidden');
                    }
                });
            }

            // --- AI Chat Modal Logic ---
            const chatModal = document.getElementById('ai-chat-modal');
            const chatBackdrop = document.getElementById('chat-backdrop');
            const toggleButton = document.getElementById('ai-modal-toggle');
            const closeButton = chatModal.querySelector('.chat-close-btn');
            const chatForm = chatModal.querySelector('.chat-input-form');
            const chatInput = chatModal.querySelector('input');
            const messagesContainer = chatModal.querySelector('.chat-messages');
            const sendButton = chatForm.querySelector('button');

            function toggleChat(show) {
                const elements = [chatModal, chatBackdrop];
                if (show) {
                    elements.forEach(el => el.classList.remove('hidden'));
                    setTimeout(() => elements.forEach(el => el.classList.add('active')), 10);
                } else {
                    elements.forEach(el => el.classList.remove('active'));
                    setTimeout(() => elements.forEach(el => el.classList.add('hidden')), 300);
                }
            }

            if (toggleButton) toggleButton.addEventListener('click', () => toggleChat(true));
            if (closeButton) closeButton.addEventListener('click', () => toggleChat(false));
            if (chatBackdrop) chatBackdrop.addEventListener('click', () => toggleChat(false));

            if (chatForm) {
                chatForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const userMessage = chatInput.value.trim();
                    if (!userMessage) return;

                    addMessage(userMessage, 'user');
                    chatInput.value = '';
                    sendButton.disabled = true;
                    showTypingIndicator(true);

                    const context = `
                        شما یک دستیار هوشمند و متخصص از "گروه کارشناسان رهبان" هستید. هویت شما حرفه‌ای، راهنما و قابل اعتماد است.
                        تخصص‌های اصلی شما عبارتند از:
                        1.  امور حقوقی: تجارت, قانون کار, تامین اجتماعی, قراردادها.
                        2.  امور بازرگانی: طرح توجیهی, ثبت سفارش, ترخیص کالا (به‌ویژه در منطقه ویژه سلفچگان).
                        3.  امور اداری و منابع انسانی: جذب و استخدام, امور بیمه.
                        4.  امور مالی: حسابرسی, مالیات, امور بانکی و LC.
                        مخاطب شما مدیران کسب‌وکارهای صنعتی و تولیدی در ایران هستند.
                        وظیفه شما ارائه پاسخ‌های اولیه و راهنما بر اساس سوالات کاربر است.
                        **مهم:** در انتهای هر پاسخ، حتماً این جمله را اضافه کنید: "این پاسخ یک راهنمایی اولیه است و جایگزین مشاوره تخصصی با کارشناسان رهبان نمی‌باشد."
                    `;
                    const fullPrompt = `${context}\n\nسوال کاربر: "${userMessage}"`;

                    try {
                        const aiResponse = await callGeminiAPI(fullPrompt);
                        addMessage(aiResponse, 'ai');
                    } catch (error) {
                        console.error("API Call failed:", error);
                        addMessage("متاسفانه در حال حاضر امکان برقراری ارتباط با سرویس هوشمند وجود ندارد. لطفاً بعداً تلاش کنید.", 'ai');
                    } finally {
                        showTypingIndicator(false);
                        sendButton.disabled = false;
                    }
                });
            }
            
            async function callGeminiAPI(prompt) {
                const apiKey = "AIzaSyAk5R5gjFMtpo0KlXnA2mxSGt1rJxhXG_o"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    return "پاسخ معتبری از سرویس دریافت نشد. ممکن است سوال شما ناقض قوانین ایمنی سرویس باشد.";
                }
            }

            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${sender}-message`;
                messageDiv.textContent = text;
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function showTypingIndicator(show) {
                let indicator = messagesContainer.querySelector('.typing-indicator');
                if (show) {
                    if (!indicator) {
                        indicator = document.createElement('div');
                        indicator.className = 'typing-indicator';
                        indicator.innerHTML = '<span></span><span></span><span></span>';
                        messagesContainer.appendChild(indicator);
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }
                } else {
                    if (indicator) {
                        indicator.remove();
                    }
                }
            }
        });
    </script>
</body>
</html>
